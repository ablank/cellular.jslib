(function(c){Drupal.progressBar=function(a,b,d,e){this.id=a;this.method=d||"GET";this.updateCallback=b;this.errorCallback=e;this.element=c('<div class="progress" aria-live="polite"></div>').attr("id",a);this.element.html('<div class="bar"><div class="filled"></div></div><div class="percentage"></div><div class="message">&nbsp;</div>')};Drupal.progressBar.prototype.setProgress=function(a,b){0<=a&&100>=a&&(c("div.filled",this.element).css("width",a+"%"),c("div.percentage",this.element).html(a+"%"));
c("div.message",this.element).html(b);this.updateCallback&&this.updateCallback(a,b,this)};Drupal.progressBar.prototype.startMonitoring=function(a,b){this.delay=b;this.uri=a;this.sendPing()};Drupal.progressBar.prototype.stopMonitoring=function(){clearTimeout(this.timer);this.uri=null};Drupal.progressBar.prototype.sendPing=function(){this.timer&&clearTimeout(this.timer);if(this.uri){var a=this;c.ajax({type:this.method,url:this.uri,data:"",dataType:"json",success:function(b){0==b.status?a.displayError(b.data):
(a.setProgress(b.percentage,b.message),a.timer=setTimeout(function(){a.sendPing()},a.delay))},error:function(b){a.displayError(Drupal.ajaxError(b,a.uri))}})}};Drupal.progressBar.prototype.displayError=function(a){a=c('<div class="messages error"></div>').html(a);c(this.element).before(a).hide();this.errorCallback&&this.errorCallback(this)}})(jQuery);